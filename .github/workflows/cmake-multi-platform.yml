name: Build Geode Mod (Windows)

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup MSVC
        uses: microsoft/setup-msbuild@v1.1

      - name: Install Scoop
        shell: powershell
        run: |
          Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser -Force
          Invoke-RestMethod -Uri https://get.scoop.sh | Invoke-Expression
          echo "$HOME\scoop\shims" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

      - name: Install Geode CLI via Scoop
        shell: powershell
        run: |
          scoop bucket add extras
          scoop install geode-sdk-cli

      # ⚠️ Profile setup must be done manually once in VSCode/local
      # Remove the --yes flag, don't run this in CI
      # Instead, run locally: geode config setup

      - name: Install Geode SDK
        shell: powershell
        run: geode sdk install

      - name: Build Mod
        shell: powershell
        run: geode build

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: geode-mod
          path: build/*